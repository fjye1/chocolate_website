<header class="navbar-bg-header m-0 p-0">
    <div class="container">
        <div class="navbar-grid">
            <!-- MOBILE PROFILE ICON (under 900px) -->
            <div class="left-section show-under-900">
                {% if current_user.is_authenticated %}
                <!-- Logged-in: show Gravatar -->
                <a href="{{ url_for('profile') }}">
                    <img src="{{ current_user.email | gravatar }}"
                         alt="Profile"
                         height="30"
                         class="rounded-circle">
                </a>
                {% else %}
                <!-- Guest: show guest icon -->
                <a href="{{ url_for('login') }}">
                    <img src="{{ url_for('static', filename='images/profile_guest.svg') }}"
                         alt="Guest Profile"
                         width="40"
                         height="40">
                </a>
                {% endif %}
            </div>

            <!-- DESKTOP NAV (over 900px) -->
            <div class="left-section hide-under-900">
                <ul class="nav mb-0">
                    {% if admin %}
                    <li><a href="{{ url_for('admin') }}" class="nav-link px-2 link-secondary">Admin</a></li>
                    {% endif %}
                    {% if not current_user.is_authenticated %}
                    <li><a href="{{ url_for('register') }}" class="nav-link px-2 link-secondary">Register</a></li>
                    <li><a href="{{ url_for('login') }}" class="nav-link px-2 link-body-emphasis">Login</a></li>
                    {% endif %}
                    <li><a href="{{ url_for('home') }}" class="nav-link px-2 link-body-emphasis">Home</a></li>
                    <li><a href="{{ url_for('product_page') }}" class="nav-link px-2 link-body-emphasis">Products</a>
                    </li>
                </ul>
            </div>


            <div class="center-logo">
                <a href="{{ url_for('home') }}">
                    <picture>
                        <!-- Medium devices -->
                        <source
                                media="(max-width: 900px)"
                                srcset="{{ url_for('static', filename='images/mobile_logo_small.png') }}">

                        <!-- Fallback / large screens -->
                        <img src="{{ url_for('static', filename='images/Logo_small.png') }}"
                             alt="Site Logo"
                             loading="lazy"
                             class="lazy-swap product-img">
                    </picture>
                </a>
            </div>

            <!-- Right section -->
            <div class="right-section">

                <!-- Search + Profile (hidden under 900px) -->
                <div class="hide-under-900 d-flex align-items-center gap-3">
                    <form role="search" action="{{ url_for('search') }}" method="GET">
                        <input type="search" name="q" class="form-control" placeholder="Search..." aria-label="Search">
                    </form>

                    {% if current_user.is_authenticated %}
                    <div class="dropdown">
                        <a href="#" class="d-block link-body-emphasis text-decoration-none dropdown-toggle"
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="{{ current_user.email | gravatar }}" alt="mdo" width="50" height="50"
                                 class="rounded-circle product-img">
                        </a>
                        <ul class="dropdown-menu text-small">
                            <li><a class="dropdown-item" href="{{url_for('profile')}}">Profile</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="{{ url_for('logout') }}">Sign out</a></li>
                        </ul>
                    </div>
                    {% endif %}
                </div>

                <!-- Cart always visible -->
                <a href="{{ url_for('cart') }}" class="nav-link px-2 link-body-emphasis">
                    <img src="{{ url_for('static', filename='images/cart.svg') }}" alt="Cart" width="50"
                         class="product-img">
                </a>
            </div>
        </div>
    </div>
</header>

<div class="categories-bg-header">
    <div class="categories-grid hide-under-900">
        <div class="left-second-section" style="height: 30px;">

            <ul class="nav mb-0">
                <li><a href="{{ url_for('product_page') }}?product=Milky"
                       class="nav-link px-2 link-body-emphasis">Milky</a></li>
                <li><a href="{{ url_for('product_page') }}?product=Saucy"
                       class="nav-link px-2 link-body-emphasis">Saucy</a></li>
            </ul>
        </div>

        <div class="center-logo" style="height: 30px;"></div>
        <div class="right-second-section" style="height: 30px;">
            <ul class="nav mb-0">
                <li><a href="{{ url_for('product_page') }}?product=Crunchy"
                       class="nav-link px-2 link-body-emphasis">Crunchy</a>
                </li>
                <li><a href="{{ url_for('product_page') }}?product=Special"
                       class="nav-link px-2 link-body-emphasis">Special</a>
                </li>
            </ul>
        </div>
    </div>


    <div class="show-under-900 mobile-search">
        <form role="search" action="{{ url_for('search') }}" method="GET">
            <input type="search" name="q" class="form-control mobile-search-input" placeholder="Search products..."
                   aria-label="Search">
        </form>
    </div>
</div>



